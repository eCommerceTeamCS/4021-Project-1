---
title: "Project 1"
author: "Shayne Cassidy (sc5za) Sarah Winston Nathan (swn2bf) Sarah Nelson (skn5mq)"
date: "10/20/2019"
output: html_notebook
---

```{r setup, include=FALSE}
require("knitr")
#traindir <- "C:/Users/swnathan/Documents/4y1s/sys4021/InClassR/Data/TrainData"
#sourcedir <-"C:/Users/swnathan/Documents/4y1s/sys4021/InClassR/RCode"
traindir <- "/Users/shaynecassidy/Desktop/4021/Data/TrainData"
sourcedir <-"/Users/shaynecassidy/Desktop/4021/RCode"
#traindir <- "/Users/student/SYS4021/Data/Trains"
#sourcedir <- "/Users/student/SYS4021/RCode"
opts_knit$set(root.dir = sourcedir)
opts_chunk$set(warning=FALSE)
```

Load data and combine data from 2001-2018 into totacts.
```{r}
# Source AccidentInput
setwd("/Users/shaynecassidy/Desktop/4021/RCode")
source("AccidentInput.R")

# list of data frames for each year of accident data
acts <- file.inputl(traindir)

# data frame with all accidents from all years from 2001 - 2018

# Get a common set the variables
comvar <- intersect(colnames(acts[[1]]), colnames(acts[[8]]))

# the combined data frame
totacts <- combine.data(acts, comvar)
```
Treatment of categorical variables

These variables will need to be tested in our hypotheses. So, in order to appropriately test the hypotheses relating to these categorical variables, these categorical variables are recoded into two levels each. 
```{r}
# Create a freight train variable
Freight <- rep(0, nrow(totacts))
Freight[which(totacts$TYPEQ == 1)] <- 1
Freight <- as.factor(Freight)

# Create a human factors variable
HF <- rep(0, nrow(totacts))
HF[which(substr(totacts$CAUSE, 1, 1) == "H")] <- 1
HF <- as.factor(HF)

# Create a derailment variable
Derail <- rep(0, nrow(totacts))
Derail[which(totacts$TYPE == 1)] <- 1 
Derail <- as.factor(Derail)

# Create a highway-rail crossing variable
HRX <- rep(0,nrow(totacts))
HRX[which(totacts$TYPE == 7)] <- 1
HRX <- as.factor(HRX)
```

Create a new variable, Casualty, where Casualty = TOTINJ + TOTKLD
```{r}
totacts$Casualty <- totacts$TOTKLD + totacts$TOTINJ
```

Build a data frame with only extreme accidents for ACCDMG
```{r}
dmgbox <- boxplot(totacts$ACCDMG)
xdmg <- totacts[totacts$ACCDMG > dmgbox$stats[5],]
# Remove duplicates from xdmg and call new data frame xdmgnd
xdmgnd <- xdmg[!(duplicated(xdmg[, c("INCDTNO", "YEAR", "MONTH", "DAY", "TIMEHR",
                                     "TIMEMIN")])),]
```

Build a data frame with only extreme accidents for Casualty
```{r}
casbox <- boxplot(totacts$Casualty)
cas <- totacts[totacts$Casualty > casbox$stats[5],]
# Remove duplicates from cdmg and call new data frame cdmgnd
casnd <- cas[!(duplicated(cas[, c("INCDTNO", "YEAR", "MONTH", "DAY", "TIMEHR",
                                     "TIMEMIN")])),]
```

## Part 1: Generating Hypotheses

Based on the analysis conducted in part 1b, I have been able to form some well-informed hypotheses from the visualizations. They are as follows, listed as null and alternative hypotheses and followed by how I arrived at them:

..As for accident severity in regards to **Accident Damage (ACCDMG)**:
*1) H0: Higher train speeds among freight trains have no effect on accident damage*
*Ha: Higher train speeds among freight trains result in higher accident damage*

*2) H0: Accidents caused by Human Factors have no effect on accident damage*
*Ha Accidents caused by Human Factors have an effect on accident damage*

..As for accident severity in regards to **Casualties**: 

*1) H0: Derailment caused accidents do not increase the number of casualties*  
*Ha: Derailment caused accidents do increase the number of casualties* 

*2) H0: Highway-rail crossing accidents are more severe than other types of accidents*
*Ha: Highway-rail crossing accidents are not more severe than other types of accidents*

## Part 2: ACCDMG Analysis

*Hypothesis 1*

Fill in here steps a-e
(a) The feature and model selection techniques you used to find appropriate models for this problem;
(b) Your treatment of ordinal and categorical variables (i.e., how were
they coded);
(c) How you assessed your models (e.g., adjusted R2, AIC, etc.);
(d) How you diagnosed problems with the models; and
(e) How you adjusted the models based on these assessments.


*Hypothesis 2*

Fill in here steps a-e
(a) The feature and model selection techniques you used to find appropriate models for this problem;
(b) Your treatment of ordinal and categorical variables (i.e., how were
they coded);
(c) How you assessed your models (e.g., adjusted R2, AIC, etc.);
(d) How you diagnosed problems with the models; and
(e) How you adjusted the models based on these assessments.


## Part 3: Casualties

*Hypothesis 1*

*1) H0: Derailment caused accidents do not increase the number of casualties*  
*Ha: Derailment caused accidents do increase the number of casualties* 

Fill in here steps a-e
(a) The feature and model selection techniques you used to find appropriate models for this problem;
(b) Your treatment of ordinal and categorical variables (i.e., how were
they coded);
(c) How you assessed your models (e.g., adjusted R2, AIC, etc.);
(d) How you diagnosed problems with the models; and
(e) How you adjusted the models based on these assessments.


*Hypothesis 2* 

Fill in here steps a-e
(a) The feature and model selection techniques you used to find appropriate models for this problem;
(b) Your treatment of ordinal and categorical variables (i.e., how were
they coded);
(c) How you assessed your models (e.g., adjusted R2, AIC, etc.);
(d) How you diagnosed problems with the models; and
(e) How you adjusted the models based on these assessments.


## Part 4: Evidence and Recommendations to FRA

### Part a)

### Part b)